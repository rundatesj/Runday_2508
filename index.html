<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>August Run - íŒ€ ë§ˆì¼ë¦¬ì§€ ëŒ€ê²°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- ìŠ¤íƒ€ì¼ ë¶€ë¶„ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ -->
    <style>
        /* ... ê¸°ì¡´ CSS ì½”ë“œ ê·¸ëŒ€ë¡œ ... */
    </style>
</head>
<body>
    <!-- HTML ë³¸ë¬¸ ë¶€ë¶„ (íŒ€ ì¹´ë“œ, ì…ë ¥ í¼, ì°¨íŠ¸, íˆìŠ¤í† ë¦¬) ê·¸ëŒ€ë¡œ ìœ ì§€ -->

    <!-- Google Sheets API ì—°ë™ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbxGia7tHLCxHqmuJYV_P_t8V6O6umdN3wAOCXrN_Taw6HV2AGRwukGwx5XrwE7_vjwK/exec";

        const crewMembers = {
            "goinggoing": "ìš°ìœ ",
            "JS Jeon": "ìš°ìœ ",
            "NJ_Run": "ìš°ìœ ",
            "ê±°ë¶ì•„ë‹¬ë ¤": "ìš°ìœ ",
            "ê²€ë‹¨ì´ë´‰ì£¼": "ìš°ìœ ",
            "ê²¨ììƒ‰ìŠˆì¦ˆ": "ìš°ìœ ",
            "ëŒì•„ì˜¨ë¹µê¾¸": "ìš°ìœ ",
            "ë§ˆì»¤ìŠ¤": "ìš°ìœ ",
            "ë¨•ë¨": "ìš°ìœ ",
            "ë¬¼ëƒ‰ëª…": "ìš°ìœ ",
            "ë´‰ë¬´ë™ëŸ¬ë„ˆ": "ìš°ìœ ",
            "ì‚¼ë‚¨ë§¤ë§˜": "ìš°ìœ ",
            "ìƒìš°ìŒìš°": "ìš°ìœ ",
            "ì‹ ìš±ì¬": "ìš°ìœ ",
            "ìš°ìœ í‚¤": "ìš°ìœ ",
            "í›„ë‹ˆ": "ìš°ìœ ",
            "ê¶Œì´ˆê²Œ": "í¬ë„",
            "ë¼ê¾¸ë¼ê¾¸ì¡°ê¹…": "í¬ë„",
            "ë§ˆì´ì„¸íŠ¸": "í¬ë„",
            "ë­‰ê³µì£¼": "í¬ë„",
            "ë°”ë‹¤": "í¬ë„",
            "ì‚ì•½ë¹„ì•½": "í¬ë„",
            "ì„¸ë™ì´": "í¬ë„",
            "ìˆ˜ë‹¤ë§˜": "í¬ë„",
            "ìˆ ìš°": "í¬ë„",
            "ì–¼ì‘¤ì•¼": "í¬ë„",
            "ìœ¤í˜¸ê·¼": "í¬ë„",
            "ì´ì‘ë‚´": "í¬ë„",
            "ìë‹¬ë§¤": "í¬ë„",
            "ì •ì˜ì¤€": "í¬ë„",
            "í•˜ëŠ˜ì€í‰": "í¬ë„",
            "í•˜í•˜í•˜ì–‘": "í¬ë„",
            "í•´í”¼ëŸ¬ë„ˆ": "í¬ë„",
            "í›„ë‹¤ë‹­": "í¬ë„"
        };

        let records = [];
        let teamChart = null;
        let dailyChart = null;

        document.addEventListener('DOMContentLoaded', function() {
            updateMemberSelect();
            loadAndRender();
        });

        function updateMemberSelect() {
            const memberSelect = document.getElementById('memberSelect');
            memberSelect.innerHTML = '<option value="">í¬ë£¨ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            const milkMembers = Object.keys(crewMembers).filter(m => crewMembers[m] === 'ìš°ìœ ');
            const grapeMembers = Object.keys(crewMembers).filter(m => crewMembers[m] === 'í¬ë„');

            const milkGroup = document.createElement('optgroup');
            milkGroup.label = 'ğŸ¥› ìš°ìœ íŒ€';
            milkMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member;
                option.textContent = member;
                milkGroup.appendChild(option);
            });
            memberSelect.appendChild(milkGroup);

            const grapeGroup = document.createElement('optgroup');
            grapeGroup.label = 'ğŸ‡ í¬ë„íŒ€';
            grapeMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member;
                option.textContent = member;
                grapeGroup.appendChild(option);
            });
            memberSelect.appendChild(grapeGroup);
        }

        document.getElementById('memberSelect').addEventListener('change', function() {
            const selected = this.value;
            const team = crewMembers[selected];
            const teamDisplay = document.getElementById('teamDisplay');
            if (team === 'ìš°ìœ ') {
                teamDisplay.textContent = 'ğŸ¥› ìš°ìœ íŒ€';
                teamDisplay.style.color = '#FF6B35';
            } else if (team === 'í¬ë„') {
                teamDisplay.textContent = 'ğŸ‡ í¬ë„íŒ€';
                teamDisplay.style.color = '#4ECDC4';
            } else {
                teamDisplay.textContent = 'íŒ€ ì •ë³´ ì—†ìŒ';
                teamDisplay.style.color = '#999';
            }
        });

        document.getElementById('recordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const selectedMember = document.getElementById('memberSelect').value;
            const distance = parseFloat(document.getElementById('distance').value);

            if (!selectedMember || !distance || distance <= 0) {
                alert('ì…ë ¥ê°’ì„ í™•ì¸í•˜ì„¸ìš”.');
                return;
            }

            const team = crewMembers[selectedMember];
            const now = new Date();

            const record = {
                id: Date.now(),
                team: team,
                name: selectedMember,
                distance: distance,
                date: now.toLocaleDateString('ko-KR'),
                time: now.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})
            };

            await fetch(SHEET_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(record)
            });

            alert('ê¸°ë¡ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
            this.reset();
            document.getElementById('teamDisplay').textContent = 'íŒ€ ì •ë³´ ì—†ìŒ';
            loadAndRender();
        });

        async function loadAndRender() {
            const res = await fetch(SHEET_API_URL);
            records = await res.json();
            updateDisplay();
        }

        function updateDisplay() {
            // íŒ€ë³„ ì´í•©, ì°¨íŠ¸, íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸ ê·¸ëŒ€ë¡œ í˜¸ì¶œ
            updateTeamTotals();
            updateMemberLists();
            updateCharts();
            updateHistory();
        }

        async function deleteRecord(id) {
            await fetch(`${SHEET_API_URL}?id=${id}`, { method: 'DELETE' });
            loadAndRender();
        }

        // ê¸°ì¡´ updateTeamTotals, updateMemberLists, updateCharts, updateHistory í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€

        function bindDeleteButtons() {
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.dataset.id;
                    if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        deleteRecord(id);
                    }
                });
            });
        }

        // updateHistory í•¨ìˆ˜ ë‚´ delete ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡í•  ë•Œ bindDeleteButtons() í˜¸ì¶œ

    </script>
</body>
</html>
